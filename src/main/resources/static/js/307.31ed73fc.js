"use strict";(self["webpackChunkyggdrasil_client"]=self["webpackChunkyggdrasil_client"]||[]).push([[307],{573:function(e,t,a){var s=a(4161),r=a(2479);a(3456);const n="http://10.100.124.9/api/v1/department/";class d{getUserDepartmentAllUsers(e){return s.Z.get(n+`users/list/${e}`,{headers:(0,r.Z)()})}getDepartmentsAll(){return s.Z.get(n+"all",{headers:(0,r.Z)()})}getDepartmentsAllSearch(e,t,a,d,l,i,o,m){let p=JSON.stringify({parameter:e,currentPage:t,sortField:a,sortDir:d,facultyName:l,isActive:i,minDate:o,maxDate:m}),c={method:"post",maxBodyLength:1/0,url:n+"search/all",headers:(0,r.Z)(),data:p};return s.Z.request(c)}getDepartmentsActiveAll(){return s.Z.get(n+"active/all",{headers:(0,r.Z)()})}updateDepartment(e,t,a,d,l){let i=JSON.stringify({id:e,shortName:t,name:a,description:d,facultyId:Number(l)}),o={method:"post",maxBodyLength:1/0,url:n+"update",headers:(0,r.Z)(),data:i};return s.Z.request(o)}createDepartment(e,t,a,d,l){let i=JSON.stringify({id:e,shortName:t,name:a,description:d,facultyId:Number(l)}),o={method:"post",maxBodyLength:1/0,url:n+"create",headers:(0,r.Z)(),data:i};return s.Z.request(o)}}t["Z"]=new d},6749:function(e,t,a){var s=a(4161),r=a(2479);const n="http://10.100.124.9/api/v1/faculty/";class d{getAllFaculty(){return s.Z.get(n+"all",{headers:(0,r.Z)()})}getAllFacultySearch(e,t,a,d,l,i,o){let m=JSON.stringify({parameter:e,currentPage:t,sortField:a,sortDir:d,isActive:l,minDate:i,maxDate:o}),p={method:"post",maxBodyLength:1/0,url:n+"search/all",headers:(0,r.Z)(),data:m};return s.Z.request(p)}getAllActiveFaculty(){return s.Z.get(n+"active/all",{headers:(0,r.Z)()})}getFaculty(e){return s.Z.get(n+e,{headers:(0,r.Z)()})}updateFaculty(e,t,a,d){let l=JSON.stringify({id:Number(e),shortName:t,name:a,description:d}),i={method:"post",maxBodyLength:1/0,url:n+"update",headers:(0,r.Z)(),data:l};return s.Z.request(i)}createFaculty(e,t,a){let d=JSON.stringify({id:null,shortName:e,name:t,description:a}),l={method:"post",maxBodyLength:1/0,url:n+"create",headers:(0,r.Z)(),data:d};return s.Z.request(l)}}t["Z"]=new d},5307:function(e,t,a){a.r(t),a.d(t,{default:function(){return oe}});var s=a(3396),r=a(7139),n=a(9242);const d={class:"chapter-name text-3xl mb-6"},l={class:"flex gap-x-5"},i={class:"menu w-1/5"},o={class:"w-4/5"},m={key:1,class:"department-body mb-10"},p={class:"menu-top mb-6 flex justify-between"},c=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 mr-1"},[(0,s._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"})],-1),u={class:"shadow-md rounded-xl border p-5"},h={class:"department-data-top-menu flex justify-between mb-5"},g={class:"department-data-status"},x={key:0,class:"text-green-600"},v={key:1,class:"text-red-600"},y={class:"department-faculty"},f={class:"department-data-dates"},w={class:"department-data-dateCreate"},b={class:"department-data-dateUpdate"},D={class:"department-data-input"},k=(0,s._)("label",{for:"",class:"relative required"},"Короткое название:",-1),_=["disabled"],C={class:"department-data-input"},U=(0,s._)("label",{for:"",class:"relative required"},"Полное название:",-1),N=["disabled"],S={class:"input-field col s12 department-data-input"},Z=(0,s._)("label",{for:"",class:"relative required"},"Выберите факультет:",-1),A=["disabled"],L=(0,s._)("option",{value:"",disabled:""},"Выберите факультет",-1),q=["value","selected"],j={class:"department-data-input"},O=(0,s._)("label",{for:"",class:"relative"},"Описание:",-1),$=["disabled"],B={class:"department-bottom-menu flex justify-end gap-5"},F=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 mr-1"},[(0,s._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})],-1),z=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 mr-1"},[(0,s._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})],-1),E={key:2,class:"main-btn px-5 py-3 text-xl inline-flex items-center",type:"submit"},T=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 mr-1"},[(0,s._)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1),I={id:"updateDepartment",class:"modal modal-fixed-footer modalUpdateDepartment"},H=(0,s.uE)('<div class="modal-content flex flex-col"><div class="modal-img inline-block p-10 rounded-full border-[8px] border-solid border-red-700 text-red-700 mx-auto mb-5 font-bold"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-[8rem]"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"></path></svg></div><div class="worn-text text-3xl text-red-700 mb-20 text-center">Внимание!</div><p class="text-2xl mb-3 text-center">Вы действительно хотите измененить данные кафедры?</p></div>',1),J={class:"modal-footer flex justify-evenly"},R=(0,s._)("a",{href:"#",class:"modal-close main-btn-invers inline-block rounded-lg px-5 py-3 w-[150px] text-center text-xl"},"Отмена",-1),V={id:"cancelUpdateDepartment",class:"modal modal-fixed-footer modalCancelUpdateDepartment"},P=(0,s.uE)('<div class="modal-content flex flex-col"><div class="modal-img inline-block p-10 rounded-full border-[8px] border-solid border-red-700 text-red-700 mx-auto mb-5 font-bold"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-[8rem]"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"></path></svg></div><div class="worn-text text-3xl text-red-700 mb-20 text-center">Внимание!</div><p class="text-2xl mb-3 text-center">Вы действительно хотите отменить изменения данных кафедры?</p></div>',1),W={class:"modal-footer flex justify-evenly"},Y=(0,s._)("a",{href:"#",class:"modal-close main-btn-invers inline-block rounded-lg px-5 py-3 w-[150px] text-center text-xl"},"Отмена",-1),K={key:2,class:"facylty-info"},G={class:"facylty-users"},Q=(0,s._)("div",{class:"facylty-users-name text-2xl mb-3"}," Сотрудники на кафедре: ",-1);function X(e,t,a,M,X,ee){const te=(0,s.up)("Sidebar"),ae=(0,s.up)("Loader"),se=(0,s.up)("MainTable");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",d," Кафедра — "+(0,r.zw)(this.departmentShortName),1),(0,s._)("div",l,[(0,s._)("div",i,[(0,s.Wm)(te)]),(0,s._)("div",o,[this.loading?((0,s.wg)(),(0,s.j4)(ae,{key:0})):((0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("div",p,[(0,s._)("button",{onClick:t[0]||(t[0]=(0,n.iM)(((...e)=>ee.back&&ee.back(...e)),["prevent"])),class:"main-btn py-3 px-5 inline-flex"},[c,(0,s.Uk)(" Вернуться ")])]),(0,s._)("div",u,[(0,s._)("div",h,[(0,s._)("div",g,[(0,s._)("div",null,[(0,s.Uk)("Статус: "),this.isActive?((0,s.wg)(),(0,s.iD)("span",x,"Активный")):((0,s.wg)(),(0,s.iD)("span",v,"Деактивированный"))]),(0,s._)("div",y,[(0,s.Uk)(" Факультет: "),(0,s._)("span",null,(0,r.zw)(this.faculty.shortName),1)])]),(0,s._)("div",f,[(0,s._)("div",w,"Дата создания: "+(0,r.zw)(this.$normaldate(this.dateCreate)),1),(0,s._)("div",b,"Дата обновления: "+(0,r.zw)(this.$normaldate(this.dateUpdate)),1)])]),(0,s._)("form",{action:"",class:"department-form",onSubmit:t[6]||(t[6]=(0,n.iM)(((...e)=>ee.updateDepartmentModel&&ee.updateDepartmentModel(...e)),["prevent"]))},[(0,s._)("div",D,[k,(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.departmentShortName=t),minlength:"1",required:"",type:"text",name:"",id:"",class:"input-text",placeholder:"Короткое название",title:"Введите короткое название",disabled:!this.updateMode},null,8,_),[[n.nr,e.departmentShortName,void 0,{trim:!0}]])]),(0,s._)("div",C,[U,(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.departmentName=t),minlength:"1",required:"",type:"text",name:"",id:"",class:"input-text",placeholder:"Полное название",title:"Введите полное название",disabled:!this.updateMode},null,8,N),[[n.nr,e.departmentName,void 0,{trim:!0}]])]),(0,s._)("div",S,[Z,(0,s._)("select",{disabled:this.updateMode},[L,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(this.facultets,(e=>((0,s.wg)(),(0,s.iD)("option",{key:e,value:e.id,selected:this.faculty.id===e.id},(0,r.zw)(e.shortName),9,q)))),128))],8,A)]),(0,s._)("div",j,[O,(0,s.wy)((0,s._)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.departmentDescrition=t),name:"",id:"",class:"input-text h-36",placeholder:"Описание",maxlength:"255",title:"Введите описание",disabled:!this.updateMode},null,8,$),[[n.nr,e.departmentDescrition,void 0,{trim:!0}]])]),(0,s._)("div",B,[this.updateMode?this.updateMode?((0,s.wg)(),(0,s.iD)("button",{key:1,class:"main-btn-red px-5 py-3 text-xl inline-flex items-center",onClick:t[5]||(t[5]=(0,n.iM)(((...e)=>ee.rajectChangesModal&&ee.rajectChangesModal(...e)),["prevent"]))},[z,(0,s.Uk)(" Отменить ")])):(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("button",{key:0,class:"main-btn px-5 py-3 text-xl inline-flex items-center",onClick:t[4]||(t[4]=(0,n.iM)(((...e)=>ee.changeOperationMode&&ee.changeOperationMode(...e)),["prevent"]))},[F,(0,s.Uk)(" Редактировать ")])),this.updateMode?((0,s.wg)(),(0,s.iD)("button",E,[T,(0,s.Uk)(" Сохранить ")])):(0,s.kq)("",!0)])],32)])])),(0,s._)("div",I,[H,(0,s._)("div",J,[(0,s._)("button",{class:"main-btn inline-block px-5 py-3 w-[150px] text-center text-xl",onClick:t[7]||(t[7]=(...e)=>ee.updateDepartment&&ee.updateDepartment(...e))},"Да"),R])]),(0,s._)("div",V,[P,(0,s._)("div",W,[(0,s._)("button",{class:"main-btn-yellow inline-block px-5 py-3 w-[150px] text-center text-xl",onClick:t[8]||(t[8]=(...e)=>ee.rajectChanges&&ee.rajectChanges(...e))},"Да"),Y])]),e.loading?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",K,[(0,s._)("div",G,[Q,(0,s.Wm)(se,{header:e.usersHeader,content:e.usersContent,noDataMessage:e.noUsersMessage},null,8,["header","content","noDataMessage"])])]))])])],64)}a(7658);var ee=a(2435),te=a(6270),ae=a(6749),se=a(573),re=a(6833),ne=a(9117),de={name:"Department",props:["departmentId"],data:()=>({loading:!0,formSelect:null,modalUpdateDepartment:null,modalCancelUpdateDepartment:null,updateMode:!1,departmentShortName:"",departmentName:"",departmentDescrition:"",isActive:"",users:[],dateCreate:"",dateUpdate:"",message:"",usersHeader:["№ сотрудника","ФИО","Роль","Кафедра","Статус","Штатный","Дата создания",""],noUsersMessage:"Сотрудники на факультете не найдены",usersContent:[],faculty:null,facultets:[],facultyMap:{}}),validations(){return{departmentShortName:{required:ne.C1,minLength:(0,ne.Ei)(1)},departmentName:{required:ne.C1,minLength:(0,ne.Ei)(1)},departmentDescrition:{minLength:(0,ne.Ei)(0)}}},async mounted(){te.Z[this.$route.query.message]&&this.$message(te.Z[this.$route.query.message]),await ae.Z.getAllFaculty().then((e=>{this.facultets=e.data;for(let t of this.facultets)this.facultyMap[t.shortName]=t.id})),await se.Z.getUserDepartmentAllUsers(this.departmentId).then((e=>{this.departmentShortName=e.data.shortName,this.departmentName=e.data.name,this.departmentDescrition=e.data.description,this.isActive=e.data.isActive,this.dateCreate=e.data.dateCreate,this.dateUpdate=e.data.dateUpdate,this.faculty=e.data.faculty,this.users=e.data.users;for(const t of this.users)"ROLE_ADMIN"!==t.roles[0].name&&"ROLE_SUPER_ADMIN"!==t.roles[0].name&&this.usersContent.push([{type:"id",text:t.id},{type:"text",text:t.lastName+" "+t.name+" "+t.patronymic,shortTest:t.lastName+" "+t.name[0]+". "+t.patronymic[0]+"."},{type:"onlyText",text:"ROLE_MODERATOR"===t.roles[0].name?"Зав. кафедрой":"Преподаватель"},{type:"text",text:t.department.name,shortTest:t.department.shortName},{type:"status",text:t.isActive?"Активный":"Деактивированный"},{type:"date",text:t.dateCreate},{type:"link",text:"Подробнее",link:"/employees/"+t.id}])}),(e=>{this.message=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),this.$error(te.Z[this.message]||"Что-то пошло не так")})),setTimeout((()=>{this.modalUpdateDepartment=M.Modal.init(document.querySelector(".modalUpdateDepartment"),{}),this.modalCancelUpdateDepartment=M.Modal.init(document.querySelector(".modalCancelUpdateDepartment"),{}),this.formSelect=M.FormSelect.init(document.querySelectorAll("select"),{})}),0),this.loading=!1},methods:{changeOperationMode(){this.updateMode=!0,this.$message("Включен режим редактирования")},rajectChanges(){this.modalCancelUpdateDepartment.close(),this.updateMode=!1,this.loading=!0,this.$message("Отмена изменений"),setTimeout((()=>{window.location.reload()}),1300)},rajectChangesModal(){this.modalCancelUpdateDepartment.open()},updateDepartmentModel(){""!==this.departmentShortName&&""!==this.departmentName?this.modalUpdateDepartment.open():this.$error("Заполните все обязательные поля")},async updateDepartment(){this.loading=!0,this.modalUpdateDepartment.close(),await se.Z.updateDepartment(this.departmentId,this.departmentShortName,this.departmentName,this.departmentDescrition,this.facultyMap[document.querySelector(".selected").textContent]).then((e=>{this.departmentShortName=e.data.shortName,this.departmentName=e.data.name,this.departmentDescrition=e.data.description,this.isActive=e.data.isActive,this.dateCreate=e.data.dateCreate,this.dateUpdate=e.data.dateUpdate,this.faculty=e.data.faculty,this.users=e.data.users}),(e=>{this.message=e.response&&e.response.data&&e.response.data.message||e.message||e.toString(),this.$error(te.Z[this.message]||"Что-то пошло не так")})),this.updateMode=!1,this.loading=!1,this.$message("Кафедра обновлена"),setTimeout((()=>{this.formSelect=M.FormSelect.init(document.querySelectorAll("select"),{})}),0)},back(){this.$router.go(-1)}},beforeDestroy(){this.formSelect&&this.formSelect.destroy&&this.formSelect.destroy(),this.modalUpdateDepartment&&this.modalUpdateDepartment.destroy&&this.modalUpdateDepartment.destroy(),this.modalCancelUpdateDepartment&&this.modalCancelUpdateDepartment.destroy&&this.modalCancelUpdateDepartment.destroy()},components:{Sidebar:ee.Z,MainTable:re.Z}},le=a(89);const ie=(0,le.Z)(de,[["render",X]]);var oe=ie}}]);
//# sourceMappingURL=307.31ed73fc.js.map